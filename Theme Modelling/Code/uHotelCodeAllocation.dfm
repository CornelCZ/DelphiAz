object HotelCodeAllocation: THotelCodeAllocation
  Left = 373
  Top = 281
  Width = 658
  Height = 444
  HelpContext = 5073
  Caption = 'Hotel Analysis Code Allocation'
  Color = clBtnFace
  Font.Charset = DEFAULT_CHARSET
  Font.Color = clWindowText
  Font.Height = -11
  Font.Name = 'MS Sans Serif'
  Font.Style = []
  OldCreateOrder = False
  Position = poMainFormCenter
  OnShow = FormShow
  PixelsPerInch = 96
  TextHeight = 13
  object lblSiteName: TLabel
    Left = 15
    Top = 16
    Width = 25
    Height = 13
    Caption = 'Site :'
    Font.Charset = DEFAULT_CHARSET
    Font.Color = clWindowText
    Font.Height = -11
    Font.Name = 'MS Shell Dlg 2'
    Font.Style = []
    ParentFont = False
  end
  object grdHotelCodesAllocation: TwwDBGrid
    Left = 15
    Top = 44
    Width = 623
    Height = 321
    ControlType.Strings = (
      'HotelCodeID;CustomEdit;cmbHotelCodes;F'
      'AnalysisCode;CustomEdit;cmbHotelCodes;F')
    Selected.Strings = (
      'HotelDivision'#9'25'#9'Hotel Division'
      'Terminal'#9'20'#9'Terminal'
      'Session'#9'20'#9'Session'
      'AnalysisCode'#9'30'#9'Analysis Code')
    IniAttributes.Delimiter = ';;'
    TitleColor = clBtnFace
    FixedCols = 3
    ShowHorzScrollBar = True
    DataSource = dsHotelCodeAllocation
    TabOrder = 0
    TitleAlignment = taCenter
    TitleFont.Charset = DEFAULT_CHARSET
    TitleFont.Color = clWindowText
    TitleFont.Height = -11
    TitleFont.Name = 'MS Sans Serif'
    TitleFont.Style = []
    TitleLines = 1
    TitleButtons = True
    OnTitleButtonClick = grdHotelCodesAllocationTitleButtonClick
    OnCalcTitleImage = grdHotelCodesAllocationCalcTitleImage
    TitleImageList = ImageList1
  end
  object cmbHotelCodes: TwwDBLookupCombo
    Left = 496
    Top = 72
    Width = 121
    Height = 21
    DropDownAlignment = taLeftJustify
    Selected.Strings = (
      'Code'#9'30'#9'Code'#9'F')
    DataField = 'HotelCodeID'
    DataSource = dsHotelCodeAllocation
    LookupTable = qryHotelCodes
    LookupField = 'ID'
    Style = csDropDownList
    TabOrder = 1
    AutoDropDown = False
    ShowButton = True
    AllowClearKey = False
    ShowMatchText = True
  end
  object btnCancel: TButton
    Left = 564
    Top = 380
    Width = 75
    Height = 25
    Caption = 'Cancel'
    ModalResult = 2
    TabOrder = 2
    OnClick = btnCancelClick
  end
  object btnOK: TButton
    Left = 476
    Top = 380
    Width = 75
    Height = 25
    Caption = 'OK'
    ModalResult = 1
    TabOrder = 3
    OnClick = btnOKClick
  end
  object edtSiteName: TEdit
    Left = 48
    Top = 12
    Width = 201
    Height = 21
    Font.Charset = DEFAULT_CHARSET
    Font.Color = clWindowText
    Font.Height = -11
    Font.Name = 'MS Shell Dlg 2'
    Font.Style = []
    ParentFont = False
    ReadOnly = True
    TabOrder = 4
    Text = 'edtSiteName'
  end
  object qryHotelCodeAllocation: TADOQuery
    Connection = dmADO.AztecConn
    CursorType = ctStatic
    BeforePost = qryHotelCodeAllocationBeforePost
    CommandTimeout = 0
    Parameters = <>
    SQL.Strings = (
      'SELECT HotelDivision, Terminal, Session,'
      
        '       HotelCodeID, HotelDivisionID, SessionID, EposDeviceID, Ch' +
        'anged,'
      '       HotelCode'
      'FROM #HotelCodesAllocation'
      'WHERE Deleted = 0'
      'ORDER BY HotelDivision, Terminal,  StartTime'
      '')
    Left = 64
    Top = 96
    object qryHotelCodeAllocationHotelDivision: TStringField
      DisplayLabel = 'Hotel Division'
      DisplayWidth = 25
      FieldName = 'HotelDivision'
      Size = 25
    end
    object qryHotelCodeAllocationTerminal: TStringField
      DisplayWidth = 20
      FieldName = 'Terminal'
      Size = 50
    end
    object qryHotelCodeAllocationSession: TStringField
      DisplayWidth = 20
      FieldName = 'Session'
    end
    object qryHotelCodeAllocationAnalysisCode: TStringField
      DisplayLabel = 'Analysis Code'
      DisplayWidth = 30
      FieldKind = fkLookup
      FieldName = 'AnalysisCode'
      LookupDataSet = qryHotelCodes
      LookupKeyFields = 'ID'
      LookupResultField = 'Code'
      KeyFields = 'HotelCodeID'
      Size = 30
      Lookup = True
    end
    object qryHotelCodeAllocationHotelCodeID: TIntegerField
      DisplayWidth = 10
      FieldName = 'HotelCodeID'
      Visible = False
    end
    object qryHotelCodeAllocationHotelDivisionID: TIntegerField
      DisplayWidth = 10
      FieldName = 'HotelDivisionID'
      Visible = False
    end
    object qryHotelCodeAllocationSessionID: TIntegerField
      DisplayWidth = 10
      FieldName = 'SessionID'
      Visible = False
    end
    object qryHotelCodeAllocationEposDeviceID: TIntegerField
      DisplayWidth = 10
      FieldName = 'EposDeviceID'
      Visible = False
    end
    object qryHotelCodeAllocationChanged: TBooleanField
      DisplayWidth = 10
      FieldName = 'Changed'
      Visible = False
    end
    object qryHotelCodeAllocationHotelCode: TStringField
      FieldName = 'HotelCode'
      Visible = False
      Size = 30
    end
  end
  object dsHotelCodeAllocation: TwwDataSource
    DataSet = qryHotelCodeAllocation
    Left = 96
    Top = 96
  end
  object qryHotelCodes: TADOQuery
    Connection = dmADO.AztecConn
    CursorType = ctStatic
    CommandTimeout = 0
    Parameters = <>
    SQL.Strings = (
      'SELECT ID, --SiteID, Package, '
      '  CASE '
      '    WHEN ID = 0 THEN '#39'<no code>'#39
      '  ELSE'
      '    Code'
      '  END AS Code'
      'FROM HotelCodes'
      'WHERE Deleted = 0'
      'ORDER BY Code')
    Left = 496
    Top = 80
    object qryHotelCodesCode: TStringField
      DisplayWidth = 30
      FieldName = 'Code'
      Size = 30
    end
    object qryHotelCodesID: TIntegerField
      FieldName = 'ID'
      Visible = False
    end
  end
  object cmdRefreshAllocation: TADOCommand
    CommandText = 
      'SET NOCOUNT ON'#13#10#13#10'DECLARE @TempHotelCodesAllocation TABLE(SiteID' +
      ' int, HotelDivisionID int, TerminalID int, SessionID int)'#13#10#13#10'-- ' +
      'ensure that the default <no code> Hotel Code exists'#13#10'IF NOT EXIS' +
      'TS (SELECT * FROM HotelCodes where ID = 0)'#13#10'BEGIN'#13#10'  INSERT [Hot' +
      'elCodes]([ID], [SiteID], [Package])'#13#10'  VALUES (0,0,'#39'RezLynx'#39')'#13#10'E' +
      'ND'#13#10#13#10'-- get all undeleted combinations of HotelDivisions, Sessi' +
      'ons and Tills'#13#10'INSERT @TempHotelCodesAllocation'#13#10'SELECT DISTINCT' +
      ' s.Id AS SiteID, d.HotelDivisionID, t.EPoSDeviceID, r.Id AS Sess' +
      'ionID'#13#10'FROM ac_Site s CROSS JOIN'#13#10'     ac_ReportingSession r CRO' +
      'SS JOIN'#13#10'     ThemeEposDevice t CROSS JOIN'#13#10'     ThemeHotelDivis' +
      'ion d'#13#10'WHERE (s.Deleted = 0) AND (t.IsServer = 0)'#13#10'AND (s.ID = t' +
      '.Sitecode) AND (t.HardwareType NOT IN (10,11))    -- Mobile Orde' +
      'ring/External API terminal hardware types'#13#10#13#10'-- insert allocatio' +
      'ns that should exist but don'#39't'#13#10'INSERT HotelCodesAllocation (Sit' +
      'eID, HotelDivisionID, EposDeviceID, SessionID)'#13#10'SELECT t.* from ' +
      '@TempHotelCodesAllocation t'#13#10'WHERE NOT EXISTS'#13#10'  (SELECT h.* '#13#10' ' +
      '  FROM HotelCodesAllocation h'#13#10'   WHERE t.SiteID = h.SiteID'#13#10'   ' +
      'AND t.HotelDivisionID = h.HotelDivisionID'#13#10'   AND t.TerminalID =' +
      ' h.EposDeviceID'#13#10'   AND t.SessionID = h.SessionID)'#13#10#13#10'-- "undele' +
      'te" and reset allocations that should be available on the HotelC' +
      'odesAllocation grid'#13#10'UPDATE HotelCodesAllocation'#13#10'  SET Deleted ' +
      '= 0,'#13#10#9'  HotelCodeID = 0'#13#10'WHERE EXISTS '#13#10'  (SELECT t.*'#13#10'   FROM ' +
      '@TempHotelCodesAllocation t'#13#10'   WHERE HotelCodesAllocation.SiteI' +
      'D = t.SiteID'#13#10'   AND HotelCodesAllocation.HotelDivisionID = t.Ho' +
      'telDivisionID'#13#10'   AND HotelCodesAllocation.EposDeviceID = t.Term' +
      'inalID'#13#10'   AND HotelCodesAllocation.SessionID = t.SessionID)'#13#10'AN' +
      'D Deleted = 1'#13#10'   '#13#10'-- delete any allocations which should no lo' +
      'nger be available on the grid'#13#10'DELETE HotelCodesAllocation'#13#10'WHER' +
      'E NOT EXISTS'#13#10'  (SELECT t.*'#13#10'   FROM @TempHotelCodesAllocation t' +
      #13#10'   WHERE HotelCodesAllocation.SiteID = t.SiteID'#13#10'   AND HotelC' +
      'odesAllocation.HotelDivisionID = t.HotelDivisionID'#13#10'   AND Hotel' +
      'CodesAllocation.EposDeviceID = t.TerminalID'#13#10'   AND HotelCodesAl' +
      'location.SessionID = t.SessionID)   '#13#10#13#10'-- ensure that HotelCode' +
      'ID is set to 0 if the division/session/eposdevice has been delet' +
      'ed'#13#10'UPDATE HotelCodesAllocation'#13#10'  SET HotelCodeID = 0'#13#10'WHERE NO' +
      'T EXISTS'#13#10'  (SELECT t.*'#13#10'   FROM @TempHotelCodesAllocation t'#13#10'  ' +
      ' WHERE HotelCodesAllocation.SiteID = t.SiteID'#13#10'   AND HotelCodes' +
      'Allocation.HotelDivisionID = t.HotelDivisionID'#13#10'   AND HotelCode' +
      'sAllocation.EposDeviceID = t.TerminalID'#13#10'   AND HotelCodesAlloca' +
      'tion.SessionID = t.SessionID) '#13#10'  '#13#10'-- Store the site'#39's allocati' +
      'ons in temp table for editing'#13#10'IF OBJECT_ID('#39'tempdb.dbo.#HotelCo' +
      'desAllocation'#39') IS NOT NULL'#13#10'BEGIN'#13#10'  TRUNCATE TABLE #HotelCodes' +
      'Allocation'#13#10'END'#13#10'ELSE'#13#10'BEGIN'#13#10'  CREATE TABLE #HotelCodesAllocati' +
      'on('#13#10'      SiteID int,'#13#10'      HotelDivisionID int,'#13#10'      EposDe' +
      'viceID int,'#13#10'      SessionID int,'#13#10'      HotelCodeID int DEFAULT' +
      ' (0),'#13#10'      Site varchar(20),'#13#10'      HotelDivision varchar(25),' +
      #13#10'      Terminal varchar(50),'#13#10'      Session varchar(20),'#13#10'     ' +
      ' StartTime datetime,'#13#10'      HotelCode varchar(30),'#13#10'      Delete' +
      'd bit DEFAULT (0),'#13#10'      Changed bit DEFAULT(0),'#13#10'    PRIMARY K' +
      'EY(SiteID, HotelDivisionID, SessionID, EposDeviceID))'#13#10'END'#13#10#13#10'IN' +
      'SERT #HotelCodesAllocation'#13#10'SELECT s.ID, a.HotelDivisionID, a.Ep' +
      'osDeviceID, a.SessionID, a.HotelCodeID, '#13#10'       s.Name AS Site,' +
      ' d.Name AS HotelDivision, t.Name AS Terminal, r.Name AS Session,' +
      ' '#13#10'       r.StartTime, hc.Code, a.Deleted, CAST(0 AS bit) AS Cha' +
      'nged '#13#10'FROM HotelCodesAllocation a INNER JOIN'#13#10'  ThemeHotelDivis' +
      'ion d ON d.HotelDivisionID = a.HotelDivisionID JOIN'#13#10'  ThemeEpos' +
      'Device t ON t.EposDeviceID = a.EposDeviceID JOIN'#13#10'  ac_Reporting' +
      'Session r ON r.ID = a.SessionID JOIN'#13#10'  ac_Site s ON s.ID = a.Si' +
      'teID JOIN'#13#10'  HotelCodes hc ON hc.ID = a.HotelCodeID '#13#10'WHERE s.ID' +
      ' = :SiteID'#13#10
    CommandTimeout = 0
    Connection = dmADO.AztecConn
    Parameters = <
      item
        Name = 'SiteID'
        DataType = ftInteger
        Value = 0
      end>
    Left = 248
    Top = 8
  end
  object cmdSaveChanges: TADOCommand
    CommandText = 
      'UPDATE HotelCodesAllocation'#13#10'  SET HotelCodeID = th.HotelCodeID'#13 +
      #10'FROM HotelCodesAllocation h INNER JOIN '#13#10'  (SELECT * FROM #Hote' +
      'lCodesAllocation WHERE Changed = 1) th'#13#10'  ON th.SiteID = h.SiteI' +
      'D'#13#10'     AND th.HotelDivisionID = h.HotelDivisionID'#13#10'     AND th.' +
      'EposDeviceID = h.EposDeviceID'#13#10'     AND th.SessionID = h.Session' +
      'ID'#13#10#13#10
    CommandTimeout = 0
    Connection = dmADO.AztecConn
    Parameters = <>
    Left = 496
    Top = 344
  end
  object ImageList1: TImageList
    Left = 328
    Top = 24
    Bitmap = {
      494C010102000400040010001000FFFFFFFFFF10FFFFFFFFFFFFFFFF424D3600
      0000000000003600000028000000400000001000000001002000000000000010
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000094ADAD0094ADAD0094ADAD0094ADAD0094ADAD0094ADAD0094ADAD000000
      0000000000000000000000000000000000000000000000000000000000000000
      000000000000000000000000000094ADAD000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000094ADAD00000000000000000000000000000000000000000094ADAD000000
      0000000000000000000000000000000000000000000000000000000000000000
      000000000000000000000000000094ADAD000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      00000000000094ADAD0000000000000000000000000094ADAD00000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000094ADAD000000000094ADAD0000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      00000000000094ADAD0000000000000000000000000094ADAD00000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000094ADAD000000000094ADAD0000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000094ADAD000000000094ADAD0000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      00000000000094ADAD0000000000000000000000000094ADAD00000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000094ADAD000000000094ADAD0000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      00000000000094ADAD0000000000000000000000000094ADAD00000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000000000000000000000000000094ADAD000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000094ADAD00000000000000000000000000000000000000000094ADAD000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000000000000000000000000000094ADAD000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000094ADAD0094ADAD0094ADAD0094ADAD0094ADAD0094ADAD0094ADAD000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      0000000000000000000000000000000000000000000000000000000000000000
      000000000000000000000000000000000000424D3E000000000000003E000000
      2800000040000000100000000100010000000000800000000000000000000000
      000000000000000000000000FFFFFF00FFFFFFFF00000000FFFFFFFF00000000
      FFFFFFFF00000000FFFFFFFF00000000F01FFEFF00000000F7DFFEFF00000000
      FBBFFD7F00000000FBBFFD7F00000000FD7FFBBF00000000FD7FFBBF00000000
      FEFFF7DF00000000FEFFF01F00000000FFFFFFFF00000000FFFFFFFF00000000
      FFFFFFFF00000000FFFFFFFF0000000000000000000000000000000000000000
      000000000000}
  end
end
